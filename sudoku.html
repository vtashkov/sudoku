<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8" />
    <title>Yana's Latin squares</title>
    <link rel="stylesheet" href="sudoku.css">
</head>

<body>
    <div id="sudoku" class="sudoku"></div>
</body>

<script>
    const getRandomInt = (max) => Math.floor(Math.random() * max);

    const generate_sudoku_numbers = (size) => {

        const is_sudoku_numbers_unfilled = (a) => {
            for (let i = 0; i < a.length; i++) {
                if (a[i] == undefined) {
                    return true;
                }
            }

            return false;
        }

        const numbers_count = size * size;
        let sudoku_numbers = new Array(numbers_count);

        do {
            rows_s = new Array(size);
            col_s = new Array(size);

            for (let i = 0; i < size; i++) {
                rows_s[i] = new Set();
                col_s[i] = new Set();
            }

            for (let i = 0; i < numbers_count; i++) {
                const row = Math.trunc(i / size);
                const column = i % size;

                const n = getRandomInt(size) + 1;

                if (rows_s[row].has(n)) {
                    break;
                }

                if (col_s[column].has(n)) {
                    break;
                }

                rows_s[row].add(n);
                col_s[column].add(n);

                sudoku_numbers[i] = n;
            }

        } while (is_sudoku_numbers_unfilled(sudoku_numbers));

        return sudoku_numbers;
    }

    const mask_grid_cells = (a, size) => {

        const total_cells = size * size;
        let number_of_cells_to_mask = total_cells - size - 1;

        while (number_of_cells_to_mask > 0) {
            const idx = getRandomInt(total_cells);

            if (a[idx] != undefined) {
                a[idx] = undefined;
                number_of_cells_to_mask--;
            }
        }

    }

    const make_sudoku_element = (size) => {
        const numbers = generate_sudoku_numbers(size);
        mask_grid_cells(numbers, size);

        const grid_element = document.createElement("div");
        grid_element.classList.add("grid");

        for (let row = 0; row < size; row++) {
            const row_element = document.createElement("div");
            row_element.classList.add("row")
            for (let column = 0; column < size; column++) {
                const cell_element = document.createElement("div");
                cell_element.classList.add("cell")
                cell_element.textContent = numbers[row * size + column];
                row_element.appendChild(cell_element);
            }
            grid_element.appendChild(row_element);
        }
        return grid_element;
    }

    const grid_size = 4;
    const grid_count = 6;
    const sudoku = document.getElementById("sudoku");

    for (let i = 0; i < grid_count; i++) {
        grid_element = make_sudoku_element(grid_size);
        sudoku.appendChild(grid_element);
    }

</script>

</html>